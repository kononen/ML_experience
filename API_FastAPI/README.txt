В данной папке написано АПИ для осуществления инференса моделей классификации, записи в Бвзу Данных PostgreSQL логов в таблицу logs и результатов инференса (метод или кодов ошибок) в таблицу tasks


Если в базе уже есть невыполненная (или «зависшая») задача, то мы возвращаем клиенту HTTP 503 Service Unavailable, потому что задача не может быть поставлена, пока предыдущая ещё не завершилась.

Если при подключении к базе что-то пошло не так (например, не смогли соединиться), any_task_processing() тоже возвращает True (логгирует ошибку и «берёт безопасность»: чтобы не дать новый запрос, пока с БД проблемы).


JSON-клиентам (через curl, Postman и т. п.) нужно отправлять «пустые» значения именно как null, а не как NaN !!!


	Возможные коды и описания ошибок у GET /status/{task_id} и GET /results/{task_id}

1. /status: 200 (если всё ок), 400 (если пустой список), 404 (если хотя бы один task_id не найден), 500 (любой другой сбой).

2. /results: 200 (даже если некоторые или все task_id не найдены, мы просто возвращаем "status":"not_found" в теле), 400 (если пустой список), 500 (при сбое БД/кода).


alexrust@Noutbuk-Pro-A-2024 API_decomposition_2 % curl -X POST "http://localhost:8000/predict" \                                                         
     -H "Content-Type: application/json" \
     -d @payload.json


alexrust@Noutbuk-Pro-A-2024 API_decomposition_2 % curl -X POST "http://localhost:8000/predict" \                                                         
     -H "Content-Type: application/json" \
     -d '{           
           "clients": [
             { "cat":"A",   "num1": 0.0,    "num2": 10.0,  "num3": null, "num4": 5.0 },
             { "cat":"B",   "num1": -50.5,  "num2": 150.0, "num3": 1.0,  "num4": 100.0 },
             { "cat":null,  "num1": 100.0,  "num2": 0.0,   "num3": 0.0,  "num4": -10.0 },
             { "cat":"C",   "num1": 50.0,   "num2": 200.0, "num3": 1.0,  "num4": 3.14 },
             { "cat":"A",   "num1": -100.0, "num2": 199.9, "num3": null, "num4": 0.0 }
           ]
         }'


curl http://127.0.0.1:8000/results/54749e33-3d6d-49c6-8b04-aad30ff1014c,baef9948-1153-4ee2-87df-4359e1df301d

curl http://127.0.0.1:8000/status/54749e33-3d6d-49c6-8b04-aad30ff1014c,baef9948-1153-4ee2-87df-4359e1df301d 

Я попробовал делать одновременно пост запросы с одними и теми же входными данными (Джейсон с 15 тыс. джейсонами с 149 признаками) с одновременно двух серверов (4 и 3 запроса одновременно), а также по отдельности с первого сервера одновременно 4 запроса, а затем со второго одновременно 3 запроса. Количество статусов 200 OK или 503 Service Unavailable разное при  





